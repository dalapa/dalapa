<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-147600577-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-147600577-2');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="account" data="3054">
    <meta name="witel" data="">
    <title>DALAPA - Data Lapangan</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
    <link href="https://dalapa.id/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://dalapa.id/assets/css/nifty.min.css" rel="stylesheet">
    <link id="theme" href="https://dalapa.id/assets/css/themes/type-e/theme-well-red.min.css" rel="stylesheet">
    <link href="./assets/plugins/themify-icons/themify-icons.min.css" rel="stylesheet">
    <style>
        body { padding-right: 0 !important }
        .modal-open {
            padding-right: 0px !important;
        }
        .modal {
            overflow-y:auto;
        }
    </style>
    <link href="https://dalapa.id/assets/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet">
<link href="https://dalapa.id/assets/plugins/datatables/media/css/dataTables.bootstrap.css" rel="stylesheet">
<link href="https://dalapa.id/assets/plugins/datatables/extensions/Buttons/css/buttons.dataTables.min.css" rel="stylesheet">
<link href="https://dalapa.id/assets/plugins/datatables/extensions/Responsive/css/responsive.dataTables.min.css" rel="stylesheet">
<link href="https://dalapa.id/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet">
<style>
    .label-custom{
        font-size: 85%;
        display: block;
    }
</style>
</head>
<body>
    <div id="container" class="effect aside-float aside-bright mainnav-lg">
        <header id="navbar">
            <div id="navbar-container" class="boxed">
                <div class="navbar-header">
                    <a href="#" class="navbar-brand">
                        <img src="https://dalapa.id/assets/img/dalapa_web.png" alt="Nifty Logo" class="brand-icon">
                        <div class="brand-title">
                            <span class="brand-text">DALAPA</span>
                        </div>
                    </a>
                </div>
                <div class="navbar-content">
                    <ul class="nav navbar-top-links">
                        <li class="tgl-menu-btn">
                            <a class="mainnav-toggle" href="#">
                                <i class="ti-menu"></i>
                            </a>
                        </li>
                        <li>
                            <div class="custom-search-form">
                                <label class="btn btn-trans" for="search-input" data-toggle="collapse" data-target="#nav-searchbox">
                                    <i class="ti-search"></i>
                                </label>
                                <form>
                                    <div class="search-container collapse" id="nav-searchbox">
                                    </div>
                                </form>
                            </div>
                        </li>
                    </ul>
                    <ul class="nav navbar-top-links">
                        <li>
                            <a href="#" class="aside-toggle">
                                <i class="ti-more"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </header>
        <div class="boxed">
            <div id="content-container">
                <div id="page-head">
    <div id="page-title">
        <h1 class="page-header text-overflow">Data Validitas Pelanggan</h1>
    </div>
    <ol class="breadcrumb">
        <li><a href="https://dalapa.id"><i class="ti-home"></i></a></li>
        <li><a href="#">Data Management</a></li>
        <li class="active">Dashboard Validitas ODP Pelanggan</li>
    </ol>
</div>
                <div id="page-content">
    <div class="row">
        <div class="col-sm-12">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Filter Data Validitas ODP Pelanggan</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label">Filter Berdasarkan : </label>
                                <select class="selectpicker form-control" name="filter_type">
                                    <option value="1">Regional</option>
                                    <option value="2">Witel</option>
                                    <option value="3">STO</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-3" id="filterWitel" style="display:none;">
                            <div class="form-group">
                                <label class="control-label">Pilih Witel : </label>
                                <select class="selectpicker form-control" name="witel_type">
                                                                            <option value="BJM">KALSEL</option>
                                                                            <option value="BPN">BALIKPAPAN</option>
                                                                            <option value="PLK">KALTENG</option>
                                                                            <option value="PTK">KALBAR</option>
                                                                            <option value="SMD">SAMARINDA</option>
                                                                            <option value="TRK">KALTARA</option>
                                                                    </select>
                            </div>
                        </div>
                        <div class="col-sm-3" id="filterSTO" style="display:none;">
                            <div class="form-group">
                                <label class="control-label">Pilih STO : </label>
                                <select class="selectpicker form-control" name="sto_type"></select>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label"><br></label>
                                <button type="button" class="btn btn-success form-control" id="filterCompare">Filter</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-heading">
                    <div class="panel-control">
                        <a href="#" class="btn btn-success btn-sm">Last Update : 19-04-2020 16:06:28</a>
                    </div>
                    <h3 class="panel-title">Data Statistik Validitas Pelanggan</h3>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-condensed">
                            <thead id="tableHead">
                                <tr>
                                    <th><center>Witel</center></th>
                                    <th><center>Total OLT</center></th>
                                    <th><center>Total Slot</center></th>
                                    <th><center>Total Pelanggan</center></th>
                                    <th><center>Pelanggan Valid</center></th>
                                    <th><center>Pelanggan Tidak Valid</center></th>
                                    <th><center>Pelanggan Belum Validasi</center></th>
                                </tr>
                            </thead>
                            <tbody id="table-body-compare-dashboard">
                                <tr>
                                    <td colspan="8">
                                        <b>
                                            <center>Silahkan Filter Data Compare Validasi....</center>
                                        </b>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Grafik Perkembangan Data Validasi ODP Pelanggan</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-2">
                            <div class="form-group">
                                <label class="control-label">Jenis Data</label>
                                <select class="selectpicker form-control" name="filter_jenis_chart">
                                    <option value="WTL">Witel</option>
                                    <option value="CAT" selected>Kategori Validitas Pelanggan</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-2" id="filterWitelChart" style="display:none">
                            <div class="form-group">
                                <label class="control-label">Filter Berdasarkan : </label>
                                <select class="selectpicker form-control" name="filter_type_chart">
                                    <option value="ALL">REGIONAL</option>
                                    <option value="BPN">BALIKPAPAN</option>
                                    <option value="SMD">SAMARINDA</option>
                                    <option value="TRK">KALTARA</option>
                                    <option value="PTK">KALBAR</option>
                                    <option value="BJM">KALSEL</option>
                                    <option value="PLK">KALTENG</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-2" id="filterKategoriChart">
                            <div class="form-group">
                                <label class="control-label">Filter Berdasarkan : </label>
                                <select class="selectpicker form-control" name="filter_cat_chart">
                                    <option value="VALID" selected>Pelanggan Valid</option>
                                    <option value="NOT_VALID">Pelanggan Not Valid</option>
                                    <option value="CHECK">Check Lapangan</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-2" id="filterTimeType">
                            <div class="form-group">
                                <label class="control-label">Jenis Waktu Data : </label>
                                <select class="selectpicker form-control" name="time_type_chart">
                                    <option value="THN">Tahunan</option>
                                    <option value="BLN">Bulanan</option>
                                    <option value="HRI">Hari</option>
                                    <option value="CSTM" selected>Custom</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-2" id="rangeTahun" style="display:none;">
                            <div class="form-group">
                                <label class="control-label">Tahun</label>
                                <select class="selectpicker form-control" name="time_year_chart">
                                                                            <option value="2019">2019</option>
                                                                            <option value="2020">2020</option>
                                                                    </select>
                            </div>
                        </div>
                        <div class="col-sm-2" id="rangeBulan" style="display:none;">
                            <div class="form-group">
                                <label class="control-label">Bulan</label>
                                <select class="selectpicker form-control" name="time_month_chart">
                                    <option value="1">Januari</option>
                                    <option value="2">Februari</option>
                                    <option value="3">Maret</option>
                                    <option value="4">April</option>
                                    <option value="5">Mei</option>
                                    <option value="6">Juni</option>
                                    <option value="7">Juli</option>
                                    <option value="8">Agustus</option>
                                    <option value="9">September</option>
                                    <option value="10">Oktober</option>
                                    <option value="11">November</option>
                                    <option value="12">Desember</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-5" id="rangeHarian">
                            <div class="form-group">
                                <label class="control-label">Rentang Hari</label>
                                <div class="input-daterange input-group" id="datepicker">
                                    <input type="text" class="form-control" name="start" autocomplete="off" value="07-04-2020"/>
                                    <span class="input-group-addon">Sampai</span>
                                    <input type="text" class="form-control" name="end" autocomplete="off" value="21-04-2020"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-1">
                            <div class="form-group">
                                <label class="control-label"><br></label>
                                <button type="button" class="btn btn-success form-control" id="filterCompareChart">Filter</button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2 col-offset-9">
                            <div class="form-group">
                                <select class="selectpicker form-control" name="type_data_chart">
                                    <option value="TOTAL">Total Data</option>
                                    <option value="PERSEN" selected>Persentase Data</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <figure class="highcharts-figure">
                        <div id="container-chart"></div>
                    </figure>
                </div>
            </div>
        </div>
    </div>
</div>
            </div>
            <nav id="mainnav-container">
                <div id="mainnav">
                    <div id="mainnav-menu-wrap">
                        <div class="nano">
                            <div class="nano-content">
                                <div id="mainnav-profile" class="mainnav-profile">
                                    <div class="profile-wrap text-center">
                                        <div class="pad-btm">
                                            <img class="img-circle img-md" src="https://dalapa.id/assets/img/profile-photos/1.png" alt="Profile Picture">
                                        </div>
                                        <a href="#profile-nav" class="box-block" data-toggle="collapse" aria-expanded="false">
                                            <p class="mnp-name">Amoeba Demo</p>
                                            <span class="mnp-desc"></span>
                                        </a>
                                    </div>
                                    <div id="profile-nav" class="collapse list-group bg-trans"></div>
                                </div>
                                <ul id="mainnav-menu" class="list-group">
                                    <li class="list-header">NAVIGASI</li>
                                    <li class="">
                                        <a href="./import_odp.html">
                                            <i class="ti-layout"></i>
                                            <span class="menu-title">Import Data ODP</span>
                                        </a>
                                    </li>
                                    <li class="">
                                        <a href="./import_port.html">
                                            <i class="ti-layout"></i>
                                            <span class="menu-title">Import Data Port ODP</span>
                                        </a>
                                    </li>
                                    <li class="">
                                        <a href="#">
                                            <i class="ti-layout"></i>
                                            <span class="menu-title">Dashboard</span>
                                                <i class="arrow"></i>
                                        </a>
                                        <ul class="collapse" aria-expanded="false">
                                            <li class="">
                                                <a href="./mapping-odp.html">Mapping OLT ODP</a>
                                            </li>
                                            <li class="">
                                                <a href="./mapping-pelanggan.html">Mapping Validitas Pelanggan</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="">
                                        <a href="./search-data.html">
                                            <i class="ti-target"></i>
                                            <span class="menu-title">Search Data ODP</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <footer id="footer">
            <div class="hide-fixed pull-right pad-rgt">
                <div class="pull-right pad-rgt">Last Update UIM : <strong>21 April 2020 01:31:01</strong></div>
            </div>
            <p class="pad-lft">&#0169; 2020 Regional Access Management Regional VI, Telkom Indonesia</p>
            <div class="pull-right pad-rgt">Last Update : <strong>21 April 2020 01:31:01</strong></div>
        </footer>
        <button class="scroll-top btn">
            <i class="pci-chevron chevron-up"></i>
        </button>
    </div>
    <div id="modalListPortValidity" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-lg" style="width:80%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="pci-cross pci-circle"></i></button>
            </div>
            <div class="modal-body">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <div class="panel-control">
                            <ul class="nav nav-tabs">
                                <li class="active"><a data-toggle="tab" href="#data-compare" aria-expanded="false">Valda by Port OLT</a></li>
                            </ul>
                        </div>
                        <h3 class="panel-title">Data Validasi</h3>
                    </div>
                    <div class="panel-body">
                        <div class="tab-content">
                            <div id="data-compare" class="tab-pane fade active in">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>GPON</th>
                                                <th>Port</th>
                                                <th>ONU</th>
                                                <th>No Telp</th>
                                                <th>No Inet</th>
                                                <th>QR DC</th>
                                                <th>Status Port</th>
                                                <th>Redaman</th>
                                                <th>ODP Lapangan</th>
                                                <th>ODP UIM</th>
                                                <th>Validitas</th>
                                            </tr>
                                        </thead>
                                        <tbody id="table-body-filter-comparing">
                                            <tr>
                                                <td colspan='11'><center>Silahkan Pilih Port OLT pada Tab Data OLT</center></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <script src="https://dalapa.id/assets/js/jquery.min.js"></script>
    <script src="https://dalapa.id/assets/js/bootstrap.min.js"></script>
    <script src="https://dalapa.id/assets/js/nifty.min.js"></script>
    <script>
    let BASE_URL_API = "https://dalapa.id/api/";
    let BASE_URL = "https://dalapa.id/";
    </script>
     <script src="https://dalapa.id/assets/plugins/loadingOverlay/loadingoverlay.min.js"></script>
     <script>
         $.ajaxSetup({
            headers: {
                'Authorization':$('meta[name=account]').attr('data'),
                'AuthWitel':$('meta[name=witel]').attr('data')
            }
        });
         $(document).ajaxStart(function () {
             $.LoadingOverlay("show");
         }).ajaxComplete(function () {
             $.LoadingOverlay("hide");
         });
     </script>
     <script src="https://dalapa.id/assets/plugins/bootstrap-select/bootstrap-select.min.js"></script>
<script src="https://dalapa.id/assets/plugins/datatables/media/js/jquery.dataTables.js"></script>
<script src="https://dalapa.id/assets/plugins/datatables/media/js/dataTables.bootstrap.js"></script>
<script src="https://dalapa.id/assets/plugins/datatables/extensions/Buttons/js/dataTables.buttons.min.js"></script>
<script src="https://dalapa.id/assets/plugins/datatables/extensions/Buttons/js/buttons.bootstrap.min.js"></script>
<script src="https://dalapa.id/assets/plugins/datatables/extensions/Responsive/js/dataTables.responsive.min.js"></script>
<script src="https://dalapa.id/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
<script>
    let selectFilterType = $('select[name=filter_type]');
    let witelFilterType = $('select[name=witel_type]');
    let stoFilterType = $('select[name=sto_type]');
    let divFilterWitel = $('div#filterWitel');
    let divFilterSTO = $('div#filterSTO');
    let btnFilter = $('button#filterCompare');
    let tbodyCompare = $('#table-body-compare-dashboard');
    let tbodyCompareDetail = $('#table-body-filter-comparing');
    let tableHead = $('#tableHead');
    let btnCompareChart = $('#filterCompareChart');
    let filterTypeChart = $('select[name=filter_type_chart]');
    let filterJenisChart = $('select[name=filter_jenis_chart]');
    let filterCatChart = $('select[name=filter_cat_chart]');
    let rangeDayDiv = $('#rangeHarian');
    let rangeMonthDiv = $('#rangeBulan');
    let rangeTahunDiv = $('#rangeTahun');
    let catDiv = $('#filterKategoriChart');
    let witelDiv = $('#filterWitelChart');
    let timeType = $('select[name=time_type_chart]');
    let dataType = $('select[name=type_data_chart]');
    let modalListPortValidity = $('#modalListPortValidity');
    $(document).ready(function(){
        filterSTO(witelFilterType.val());
        filterByRegional();
        $('.input-daterange').datepicker({
            format: "dd-mm-yyyy",
            todayBtn: "linked",
            autoclose: true,
            todayHighlight: true
        });
        selectFilterType.change(function(){
            let type = selectFilterType.val();
            switch (type) {
                case '1':
                    divFilterWitel.hide();
                    divFilterSTO.hide();
                    break;
                case '2':
                    divFilterWitel.show();
                    divFilterWitel.attr('class','col-sm-6')
                    divFilterSTO.hide();
                    break;
                case '3':
                    filterSTO(witelFilterType.val());
                    divFilterWitel.show();
                    divFilterWitel.attr('class','col-sm-3')
                    divFilterSTO.show();
                    break;
            }
        });
        witelFilterType.change(function(){
            if(selectFilterType.val()=='3'){
                filterSTO(witelFilterType.val());
            }
        });
        btnFilter.click(function(){
            let type = selectFilterType.val();
            switch (type) {
                case '1':
                    filterByRegional();
                    break;
                case '2':
                    filterByWitel();
                    break;
                case '3':
                    filterBySTO(stoFilterType.val());
                    break;
            }
        });
        timeType.change(function(){
            switch ($(this).val()) {
                case 'THN':
                    rangeDayDiv.hide();
                    rangeMonthDiv.hide();
                    rangeTahunDiv.hide();
                    break;
                case 'BLN':
                    rangeDayDiv.hide();
                    rangeMonthDiv.hide();
                    rangeTahunDiv.show();
                    rangeTahunDiv.removeAttr('class').addClass('col-sm-5');
                    break;
                case 'HRI':
                    rangeDayDiv.hide();
                    rangeMonthDiv.show();
                    rangeTahunDiv.show();
                    rangeTahunDiv.removeAttr('class').addClass('col-sm-2');
                    rangeMonthDiv.removeAttr('class').addClass('col-sm-2');
                    break;
                case 'CSTM':
                    rangeDayDiv.show();
                    rangeMonthDiv.hide();
                    rangeTahunDiv.hide();
                    rangeDayDiv.removeAttr('class').addClass('col-sm-5');
                    break;
                default:
                    break;
            }
        });
        btnCompareChart.click(function(){
            makeChart();
        });
        filterJenisChart.change(function(){
            if($(this).val()==="WTL"){
                catDiv.hide();
                witelDiv.show();
            }else if($(this).val()==="CAT"){
                catDiv.show();
                witelDiv.hide();
            }
        });
        makeChart();
    });
    $(document).on('click','.detailRegional',function(){
        selectFilterType.val(2).selectpicker('refresh');
        witelFilterType.val($(this).attr('data-witel')).selectpicker('refresh');
        divFilterWitel.show();
        divFilterWitel.attr('class','col-sm-6')
        divFilterSTO.hide();
        filterByWitel();
    });
    $(document).on('click','.detailWitel',function(){
        selectFilterType.val(3).selectpicker('refresh');
        $.post(BASE_URL_API + "data/filterSTO",{'id_witel_data':witelFilterType.val()},function(res){
            $.each(res,function(k,v){
                stoFilterType.append($('<option>', {
                    value: v.sto_name,
                    text: v.sto_name
                }));
            });
        }).done(function(){
            stoFilterType.val($(this).attr('data-sto')).selectpicker('refresh');
        });
        divFilterWitel.show();
        divFilterWitel.attr('class','col-sm-3')
        divFilterSTO.show();
        filterBySTO($(this).attr('data-sto'));
    });
    $(document).on('click','.detailGPON',function(){
        let gpon = $(this).text();
        filterByGPON(gpon);
    });
    $(document).on('click','.detailPort',function(){
        let slot = $(this).attr('data-slot');
        let gpon = $(this).attr('data-gpon');
        filterBySlot(slot,gpon);
    });
    $(document).on('click','.detailPortAll',function(){
        let gpon = $(this).attr('data-gpon');
        let slot = $(this).attr('data-slot');
        let port = $(this).attr('data-port');
        filterByPortType(slot,port,gpon,null);
    });
    $(document).on('click','.detailPortValid',function(){
        let gpon = $(this).attr('data-gpon');
        let slot = $(this).attr('data-slot');
        let port = $(this).attr('data-port');
        filterByPortType(slot,port,gpon,1);
    });
    $(document).on('click','.detailPortNotValid',function(){
        let gpon = $(this).attr('data-gpon');
        let slot = $(this).attr('data-slot');
        let port = $(this).attr('data-port');
        filterByPortType(slot,port,gpon,2);
    });
    $(document).on('click','.detailPortNotYet',function(){
        let gpon = $(this).attr('data-gpon');
        let slot = $(this).attr('data-slot');
        let port = $(this).attr('data-port');
        filterByPortType(slot,port,gpon,3);
    });
    function filterByRegional(){
        filterSTO(witelFilterType.val());
        tableHead.html(`
            <tr>
                <th><center>Witel</center></th>
                <th><center>OLT Total</center></th>
                <th><center>Slot Total</center></th>
                <th><center>Pelanggan Total</center></th>
                <th><center>Pelanggan Valid</center></th>
                <th><center>Pelanggan Tidak Valid</center></th>
                <th><center>Pelanggan Belum Validasi</center></th>
            </tr>
        `);
        $.post(BASE_URL_API + "data/olt/statCompare",{'type':1},function(res){
            tbodyCompare.empty();
            $.each(res,function(key,value){
                percentValid = (value.valid/value.total) * 100;
                percentNotValid = (value.not_valid / value.total) * 100;
                percentNotYet = (value.not_yet / value.total) * 100;
                let witel = null;
                switch (key) {
                    case 'BPN':
                        witel = "BPP";
                        break;
                    case 'SMD':
                        witel = "SMR";
                        break;
                    default:
                        witel = key;
                        break;
                }
                switch (key) {
                  case 'allWitel':
                        tbodyCompare.append(`
                            <tr>
                                <td><center><strong>TREG6</strong></center></td>
                                <td><center><strong>${value.total_gpon}</strong></center></td>
                                <td><center><strong>${value.total_slot}</strong></center></td>
                                <td><center><strong>${value.total}</strong></center></td>
                                <td><center><strong>${value.valid}</strong><button class="btn btn-mint btn-xs pull-right"><strong>${percentValid.toFixed(4)} %</strong></button></center></td>
                                <td><center><strong>${value.not_valid}</strong> <button class="btn btn-danger btn-xs pull-right"><strong>${percentNotValid.toFixed(4)} %</strong></button></center></td>
                                <td><center><strong>${value.not_yet}</strong> <button class="btn btn-warning btn-xs pull-right"><strong>${percentNotYet.toFixed(4)} %</strong></button></center></td>
                            </tr>
                        `);
                        break;
                  default:
                        tbodyCompare.append(`
                            <tr>
                                <td><center><a href="#" class="btn-link detailRegional" data-witel="${key}"><u>${witel}</u></a></center></td>
                                <td><center>${value.total_gpon}</center></td>
                                <td><center>${value.total_slot}</center></td>
                                <td><center>${value.total}</center></td>
                                <td><center>${value.valid} <button class="btn btn-mint btn-xs pull-right">${percentValid.toFixed(4)} %</button></center></td>
                                <td><center>${value.not_valid} <button class="btn btn-danger btn-xs pull-right">${percentNotValid.toFixed(4)} %</button></center></td>
                                <td><center>${value.not_yet} <button class="btn btn-warning btn-xs pull-right">${percentNotYet.toFixed(4)} %</button></center></td>
                            </tr>
                        `);
                        break;
                }

            });
        });
    }
    function filterByWitel(){
        filterSTO(witelFilterType.val());
        tableHead.html(`
            <tr>
                <th><center>STO</center></th>
                <th><center>OLT Total</center></th>
                <th><center>Slot Total</center></th>
                <th><center>Pelanggan Total</center></th>
                <th><center>Pelanggan Valid</center></th>
                <th><center>Pelanggan Tidak Valid</center></th>
                <th><center>Pelanggan Belum Validasi</center></th>
            </tr>
        `);
        $.post(BASE_URL_API + "data/olt/statCompare",{'type':2,'witel':witelFilterType.val()},function(res){
            tbodyCompare.empty();
            $.each(res,function(key,value){
                percentValid = (value.valid/value.total) * 100;
                percentNotValid = (value.not_valid / value.total) * 100;
                percentNotYet = (value.not_yet / value.total) * 100;
                tbodyCompare.append(`
                    <tr>
                        <td><center><a href="#" class="btn-link detailWitel" data-sto="${key}" data-witel="${witelFilterType.val()}"><u>${key}</u></a></center></td>
                        <td><center>${value.total_gpon}</center></td>
                        <td><center>${value.total_slot}</center></td>
                        <td><center>${value.total}</center></td>
                        <td><center>${value.valid} <button class="btn btn-mint btn-xs pull-right">${percentValid.toFixed(4)} %</button></center></td>
                        <td><center>${value.not_valid} <button class="btn btn-danger btn-xs pull-right">${percentNotValid.toFixed(4)} %</button></center></td>
                        <td><center>${value.not_yet} <button class="btn btn-warning btn-xs pull-right">${percentNotYet.toFixed(4)} %</button></center></td>
                    </tr>
                `);
            });
        });
    }
    function filterBySTO(sto){
        tableHead.html(`
            <tr>
                <th><center>OLT</center></th>
                <th><center>Slot Total</center></th>
                <th><center>Pelanggan Total</center></th>
                <th><center>Pelanggan Valid</center></th>
                <th><center>Pelanggan Tidak Valid</center></th>
                <th><center>Pelanggan Belum Validasi</center></th>
            </tr>
        `);
        $.post(BASE_URL_API + "data/olt/statCompare",{'type':3,'sto':sto},function(res){
            tbodyCompare.empty();
            $.each(res,function(key,value){
                percentValid = (value.valid/value.total) * 100;
                percentNotValid = (value.not_valid / value.total) * 100;
                percentNotYet = (value.not_yet / value.total) * 100;
                tbodyCompare.append(`
                    <tr>
                        <td><center><a href="#" class="btn-link detailGPON" data-id="${key}">${key}</a></center></td>
                        <td><center>${value.total_slot}</center></td>
                        <td><center>${value.total}</center></td>
                        <td><center>${value.valid} <button class="btn btn-mint btn-xs pull-right">${percentValid.toFixed(4)} %</button></center></td>
                        <td><center>${value.not_valid} <button class="btn btn-danger btn-xs pull-right">${percentNotValid.toFixed(4)} %</button></center></td>
                        <td><center>${value.not_yet} <button class="btn btn-warning btn-xs pull-right">${percentNotYet.toFixed(4)} %</button></center></td>
                    </tr>
                `);
            });
        });
    }
    function filterByGPON(gpon){
        tableHead.html(`
            <tr>
                <th><center>OLT</center></th>
                <th><center>Port Total</center></th>
                <th><center>Pelanggan Total</center></th>
                <th><center>Pelanggan Valid</center></th>
                <th><center>Pelanggan Tidak Valid</center></th>
                <th><center>Pelanggan Belum Validasi</center></th>
            </tr>
        `);
        $.post(BASE_URL_API + "data/olt/statCompare",{'type':4,'gpon':gpon},function(res){
            tbodyCompare.empty();
            $.each(res,function(key,value){
                percentValid = (value.valid/value.total) * 100;
                percentNotValid = (value.not_valid / value.total) * 100;
                percentNotYet = (value.not_yet / value.total) * 100;
                tbodyCompare.append(`
                    <tr>
                        <td><center>${gpon} <button class="btn btn-info btn-xs pull-right">Slot : ${key}</button></center></td>
                        <td><center><a href="#" class="btn-link detailPort" data-slot="${key}" data-gpon="${gpon}"><u>${value.total_port}</u></a></center></td>
                        <td><center>${value.total}</center></td>
                        <td><center>${value.valid} <button class="btn btn-mint btn-xs pull-right">${percentValid.toFixed(4)} %</button></center></td>
                        <td><center>${value.not_valid} <button class="btn btn-danger btn-xs pull-right">${percentNotValid.toFixed(4)} %</button></center></td>
                        <td><center>${value.not_yet} <button class="btn btn-warning btn-xs pull-right">${percentNotYet.toFixed(4)} %</button></center></td>
                    </tr>
                `);
            });
        });
    }
    function filterBySlot(slot,gpon){
        tableHead.html(`
            <tr>
                <th><center>OLT</center></th>
                <th><center>Port</center></th>
                <th><center>Pelanggan Total</center></th>
                <th><center>Pelanggan Valid</center></th>
                <th><center>Pelanggan Tidak Valid</center></th>
                <th><center>Pelanggan Belum Validasi</center></th>
            </tr>
        `);
        $.post(BASE_URL_API + "data/olt/statCompare",{'type':5,'gpon':gpon,'slot':slot},function(res){
            tbodyCompare.empty();
            $.each(res,function(key,value){
                percentValid = (value.valid/value.total) * 100;
                percentNotValid = (value.not_valid / value.total) * 100;
                percentNotYet = (value.not_yet / value.total) * 100;
                tbodyCompare.append(`
                    <tr>
                        <td><center>${gpon}</center></td>
                        <td><center><a href="#" class="btn btn-success btn-link btn-xs btn-block">1-${slot}-${key}</a></center></td>
                        <td><center><a href="#" class="btn-link detailPortAll" data-gpon="${gpon}" data-slot="${slot}" data-port="${key}">${value.total}</a></center></td>
                        <td><center><a href="#" class="btn-link detailPortValid" data-gpon="${gpon}" data-slot="${slot}" data-port="${key}">${value.valid} <button class="btn btn-mint btn-xs pull-right">${percentValid.toFixed(4)} %</button></a></center></td>
                        <td><center><a href="#" class="btn-link detailPortNotValid" data-gpon="${gpon}" data-slot="${slot}" data-port="${key}">${value.not_valid}</a> <button class="btn btn-danger btn-xs pull-right">${percentNotValid.toFixed(4)} %</button></center></td>
                        <td><center><a href="#" class="btn-link detailPortNotYet" data-gpon="${gpon}" data-slot="${slot}" data-port="${key}">${value.not_yet}</a> <button class="btn btn-warning btn-xs pull-right">${percentNotYet.toFixed(4)} %</button></center></td>
                    </tr>
                `);
            });
        });
    }
    function filterByPortType(slot,port,gpon,type){
        $.post(BASE_URL_API + "data/olt/statCompare",{'type':6,'gpon':gpon,'slot':slot,'port':port,'validitas':type},function(res){
            tbodyCompareDetail.empty();
            $.each(res,function(key,value){
                let odp_lapangan = "";
                    let odp_uim = "";
                    let validitas = null;
                    let status = null;
                    switch (value.validitas) {
                        case '1':
                            validitas = "<button class='btn btn-success btn-xs btn-block'>OK</button>";
                            odp_lapangan = `<button class='btn btn-success btn-xs detailPelanggan' data-odp="${value.odp_lapangan}">${value.odp_lapangan}</button>`;
                            odp_uim = `<button class='btn btn-success btn-xs detailPelanggan' data-odp="${value.odp_uim}">${value.odp_uim}</button>`;
                            break;
                        case '2':
                            validitas = "<button class='btn btn-danger btn-xs btn-block'>NO</button>";
                            odp_lapangan = `<button class='btn btn-danger btn-xs detailPelanggan' data-odp="${value.odp_lapangan}">${value.odp_lapangan}</button>`;
                            odp_uim = `<button class='btn btn-danger btn-xs detailPelanggan' data-odp="${value.odp_uim}">${value.odp_uim}</button>`;
                            break;
                        case '3':
                            validitas = "<button class='btn btn-warning btn-xs btn-block'>NOT YET</button>";
                            if(value.odp_lapangan != null){
                                odp_lapangan = `<button class='btn btn-warning btn-xs detailPelanggan' data-odp="${value.odp_lapangan}">${value.odp_lapangan}</button>`;
                            }
                            if(value.odp_uim != null){
                                odp_uim = `<button class='btn btn-warning btn-xs detailPelanggan' data-odp="${value.odp_uim}">${value.odp_uim}</button>`;
                            }
                            break;
                    }
                    switch (value.type) {
                        case '1':
                            status = `<button class="btn btn-purple btn-xs btn-block">Teridentifikasi</button>`;
                            break;
                        case '2':
                            status = `<button class="btn btn-dark btn-xs btn-block">Tidak Teridentifikasi</button>`;
                            break;
                        case '3':
                            status = `<button class="btn btn-danger btn-xs btn-block">Rusak</button>`;
                            break;
                        case '4':
                            status = `<button class="btn btn-success btn-xs btn-block">Idle</button>`;
                            break;
                        default:
                            status = `<center>-<center>`;
                            break;
                    }
                tbodyCompareDetail.append(`
                        <tr>
                            <td style="white-space:nowrap;">${value.gpon}</td>
                            <td style="white-space:nowrap;">1-${value.slot}-${value.port}</td>
                            <td>-</td>
                            <td style="white-space:nowrap;">${value.no_telp}</td>
                            <td style="white-space:nowrap;">${value.no_inet}</td>
                            <td>${(value.qr_code_dropcore != null ? value.qr_code_dropcore : '-')}</td>
                            <td style="white-space:nowrap;">${status}</td>
                            <td>${value.redaman}</td>
                            <td style="white-space:nowrap;">${odp_lapangan}</td>
                            <td style="white-space:nowrap;">${odp_uim}</td>
                            <td style="white-space:nowrap;">${validitas}</td>
                        </tr>
                    `);
            });
        }).done(function(){
            modalListPortValidity.modal('show');
        });
    }
    function filterSTO(witel){
        tableHead.html(`
            <tr>
                <th><center>OLT</center></th>
                <th><center>Slot Total</center></th>
                <th><center>Port Total</center></th>
                <th><center>Port Valid</center></th>
                <th><center>Port Tidak Valid</center></th>
                <th><center>Port Cek Lapangan</center></th>
            </tr>
        `);
        stoFilterType.empty();
        $.post(BASE_URL_API + "data/filterSTO",{'id_witel_data':witel},function(res){
            $.each(res,function(k,v){
                stoFilterType.append($('<option>', {
                    value: v.sto_name,
                    text: v.sto_name
                }));
            });
        }).done(function(){
            stoFilterType.selectpicker('refresh');
        });
    }
    function makeChart(){
        let type = timeType.val();
        let time_year_chart = $('select[name=time_year_chart]').val();
        let time_month_chart = $('select[name=time_month_chart]').val();
        let day_start = $('input[name=start]').val();
        let day_finish = $('input[name=end]').val();
        let filter_type_chart = filterTypeChart.val();
        let filter_data_type = dataType.val();
        let filter_jenis_chart = filterJenisChart.val();
        let filter_cat_chart = filterCatChart.val();
        if(type=="CSTM"){
            if((day_start === null || day_start === "") || (day_finish === null || day_finish === "")){
                $.niftyNoty({
                    type: 'danger',
                    container : 'floating',
                    title : 'Information',
                    message : "Rentang Tanggal Harus diisikan",
                    closeBtn : false,
                    timer : 3000
                });
                return;
            }
        }
        $.post(BASE_URL_API + "chart/generate-compare",{
            filter_cat_chart,
            filter_jenis_chart,
            filter_type_chart,
            filter_data_type,
            type,
            time_year_chart,
            time_month_chart,
            day_start,
            day_finish
        },function(res){
            if(res.status){
                Highcharts.chart('container-chart', {
                    title: {
                        text: 'Riwayat Statistik Data Validitas Pelanggan'
                    },
                    subtitle: {
                        text: `Last Update : ${res.last_update}`
                    },
                    yAxis: {
                        title: {
                            text: `Total Data ${(filter_data_type === "PERSEN" ? "%" : "")}`
                        }
                    },
                    xAxis: {
                        categories: res.category
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle'
                    },
                    plotOptions: {
                        series: {
                            label: {
                                enabled:false,
                                connectorAllowed: false
                            }
                        }
                    },
                    series: res.data_series,
                    responsive: {
                        rules: [{
                            condition: {
                                maxWidth: 500
                            },
                            chartOptions: {
                                legend: {
                                    layout: 'horizontal',
                                    align: 'center',
                                    verticalAlign: 'bottom'
                                }
                            }
                        }]
                    }
                });
            }
        });
    }
</script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
</body>
</html>